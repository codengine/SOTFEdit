<mah:MetroWindow
    x:Class="SOTFEdit.View.MapWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:SOTFEdit.Infrastructure.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:infrastructure="clr-namespace:SOTFEdit.Infrastructure"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:SOTFEdit.Model.Map"
    xmlns:st="http://schemas.spicytaco.io/"
    xmlns:viewModel="clr-namespace:SOTFEdit.ViewModel"
    xmlns:zoomControl="clr-namespace:ZoomControl;assembly=ZoomControl"
    Title="{infrastructure:Translate 'menu.tools.map.text'}"
    Width="1024"
    Height="768"
    d:DataContext="{d:DesignInstance viewModel:MapViewModel}"
    Background="{Binding MapBackground}"
    PreviewKeyDown="MapWindow_OnPreviewKeyDown"
    TitleCharacterCasing="Normal"
    WindowTransitionsEnabled="False"
    mc:Ignorable="d">
    <mah:MetroWindow.LeftWindowCommands>
        <mah:WindowCommands VerticalAlignment="Center" VerticalContentAlignment="Center">
            <Image
                Width="24"
                Height="24"
                mah:VisibilityHelper.IsCollapsed="{Binding IsNotConnected}"
                ToolTip="{infrastructure:Translate 'companion.status.connected'}">
                <Image.Source>
                    <iconPacks:FontAwesomeImage Brush="{StaticResource MahApps.Brushes.ThemeForeground}" Kind="PlugSolid" />
                </Image.Source>
            </Image>
        </mah:WindowCommands>
    </mah:MetroWindow.LeftWindowCommands>
    <mah:MetroWindow.RightWindowCommands>
    <mah:WindowCommands ShowLastSeparator="True">
            <CheckBox
                Margin="0,0,8,0"
                mah:CheckBoxHelper.CheckBackgroundFillChecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUnchecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckGlyphForegroundChecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUnchecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                Content="{infrastructure:Translate 'map.followPlayer'}"
                IsChecked="{Binding FollowPlayer, UpdateSourceTrigger=PropertyChanged}" />
            <CheckBox
                Margin="0,0,8,0"
                mah:CheckBoxHelper.CheckBackgroundFillChecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUnchecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckGlyphForegroundChecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUnchecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                Content="{infrastructure:Translate 'autoConnect'}"
                IsChecked="{Binding AutoConnect, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <CheckBox
                Margin="0,0,8,0"
                mah:CheckBoxHelper.CheckBackgroundFillChecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUnchecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckGlyphForegroundChecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUnchecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                Content="{infrastructure:Translate 'autoReload'}"
                IsChecked="{Binding AutoReload, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <CheckBox
                Margin="0,0,8,0"
                mah:CheckBoxHelper.CheckBackgroundFillChecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillCheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUnchecked="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedMouseOver="Transparent"
                mah:CheckBoxHelper.CheckBackgroundFillUncheckedPressed="Transparent"
                mah:CheckBoxHelper.CheckGlyphForegroundChecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundCheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUnchecked="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedMouseOver="{DynamicResource MahApps.Brushes.ThemeForeground}"
                mah:CheckBoxHelper.CheckGlyphForegroundUncheckedPressed="{DynamicResource MahApps.Brushes.ThemeForeground}"
                Checked="AlwaysOnTop_OnChecked"
                Content="{infrastructure:Translate 'map.alwaysOnTop'}"
                Unchecked="AlwaysOnTop_OnUnchecked" />
        </mah:WindowCommands>
    </mah:MetroWindow.RightWindowCommands>
    <mah:MetroWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/View/Map/Details/ItemPoiDetailsTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/CaveOrBunkerDetailsTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/GenericInformationalPoiDetailTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/WorldItemPoiDetailsTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/ActorPoiDetailsTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/StructurePoiDetailsTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/DefaultPoiDetailsTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/ZipPointPoiDetailsTemplate.xaml" />
                <ResourceDictionary Source="/View/Map/Details/CustomPoiDetailsTemplate.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <infrastructure:ZoomHandler x:Key="ZoomHandler" />
            <converters:BoolToBorderBrushConverter x:Key="BoolToBorderBrushConverter" />
            <converters:HalfWidthConverter x:Key="HalfWidthConverter" />
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

            <DataTemplate x:Key="PoiTemplate" DataType="{x:Type models:IPoi}">
                <Border
                    BorderBrush="{Binding IsSelected, Converter={StaticResource BoolToBorderBrushConverter}}"
                    BorderThickness="1"
                    Visibility="{Binding Visible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Border.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform ScaleX="{Binding ZoomInverse, Source={StaticResource ZoomHandler}}" ScaleY="{Binding ZoomInverse, Source={StaticResource ZoomHandler}}" />
                            <RotateTransform Angle="{Binding IconRotation}" />
                        </TransformGroup>
                    </Border.RenderTransform>
                    <Border.RenderTransformOrigin>
                        <Point X="0.5" Y="0.5" />
                    </Border.RenderTransformOrigin>
                    <Grid>
                        <Image
                            Width="{Binding IconWidth, Mode=OneTime}"
                            Height="{Binding IconHeight, Mode=OneTime}"
                            Cursor="Hand"
                            Source="{Binding Icon, Mode=OneTime}"
                            Tag="{Binding}"
                            ToolTip="{Binding Title, Mode=OneTime}" />
                        <Image
                            Width="{Binding IconWidth, Mode=OneTime}"
                            Height="{Binding IconHeight, Mode=OneTime}"
                            Margin="0,0,0,0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            IsHitTestVisible="False"
                            Source="/images/icons/done.png"
                            Visibility="{Binding IsDone, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </Grid>
                </Border>
            </DataTemplate>

            <DataTemplate x:Key="NetworkPlayerPoiTemplate" DataType="{x:Type models:NetworkPlayerPoi}">
                <Grid>
                    <Grid.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform ScaleX="{Binding ZoomInverse, Source={StaticResource ZoomHandler}}" ScaleY="{Binding ZoomInverse, Source={StaticResource ZoomHandler}}" />
                            <RotateTransform Angle="{Binding IconRotation}" />
                        </TransformGroup>
                    </Grid.RenderTransform>
                    <Grid.RenderTransformOrigin>
                        <Point X="0.5" Y="0.5" />
                    </Grid.RenderTransformOrigin>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Border
                        BorderBrush="{Binding IsSelected, Converter={StaticResource BoolToBorderBrushConverter}}"
                        BorderThickness="1"
                        Visibility="{Binding Visible, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Image
                            Width="{Binding IconWidth, Mode=OneTime}"
                            Height="{Binding IconHeight, Mode=OneTime}"
                            Cursor="Hand"
                            Source="{Binding Icon, Mode=OneTime}"
                            Tag="{Binding}"
                            ToolTip="{Binding Title}" />
                    </Border>
                    <TextBlock
                        Grid.Row="1"
                        MaxWidth="100"
                        FontWeight="Bold"
                        Foreground="{Binding DataContext.NetworkPlayerForeground, RelativeSource={RelativeSource AncestorType={x:Type mah:MetroWindow}}}"
                        Text="{Binding Title}"
                        TextAlignment="Center"
                        TextWrapping="Wrap" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ZipPoiTemplate" DataType="{x:Type models:ZipPointPoi}">
                <Border
                    BorderBrush="{Binding IsSelected, Converter={StaticResource BoolToBorderBrushConverter}}"
                    BorderThickness="1"
                    Visibility="{Binding Visible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Image
                        Width="{Binding IconWidth, Mode=OneTime}"
                        Height="{Binding IconHeight, Mode=OneTime}"
                        Cursor="Hand"
                        Source="{Binding Icon, Mode=OneTime}"
                        Tag="{Binding}"
                        ToolTip="{Binding Title, Mode=OneTime}" />
                </Border>
            </DataTemplate>

            <DataTemplate x:Key="ZiplineTemplate" DataType="{x:Type models:ZiplinePoi}">
                <Line
                    Stroke="Black"
                    StrokeThickness="2"
                    Visibility="{Binding Enabled, Converter={StaticResource BooleanToVisibilityConverter}}"
                    X1="{Binding X1}"
                    X2="{Binding X2}"
                    Y1="{Binding Y1}"
                    Y2="{Binding Y2}" />
            </DataTemplate>


            <infrastructure:PoiTemplateSelector
                x:Key="PoiTemplateSelector"
                NetworkPlayerPoiTemplate="{StaticResource NetworkPlayerPoiTemplate}"
                PoiTemplate="{StaticResource PoiTemplate}"
                ZipPoiTemplate="{StaticResource ZipPoiTemplate}"
                ZiplineTemplate="{StaticResource ZiplineTemplate}" />

            <infrastructure:PoiDetailsTemplateSelector
                x:Key="PoiDetailsTemplateSelector"
                ActorPoiDetailsTemplate="{StaticResource ActorPoiDetailsTemplate}"
                CaveOrBunkerPoiDetailsTemplate="{StaticResource CaveOrBunkerDetailsTemplate}"
                CustomPoiDetailsTemplate="{StaticResource CustomPoiDetailsTemplate}"
                DefaultPoiTemplate="{StaticResource DefaultPoiDetailsTemplate}"
                GenericInformationalPoiDetailsTemplate="{StaticResource GenericInformationalPoiDetailTemplate}"
                ItemPoiDetailsTemplate="{StaticResource ItemPoiDetailsTemplate}"
                StructurePoiDetailsTemplate="{StaticResource StructurePoiDetailsTemplate}"
                WorldItemPoiDetailsTemplate="{StaticResource WorldItemPoiDetailsTemplate}"
                ZipPointPoiDetailsTemplate="{StaticResource ZipPointPoiDetailsTemplate}" />
        </ResourceDictionary>
    </mah:MetroWindow.Resources>
    <mah:MetroWindow.Flyouts>
        <mah:FlyoutsControl>
            <mah:Flyout
                x:Name="MapOptionsFlyout"
                Width="320"
                AreAnimationsEnabled="False"
                Header="{infrastructure:Translate 'map.options'}"
                Position="Left">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <GroupBox Margin="0,0,0,6" Header="{infrastructure:Translate 'map.options'}">
                        <st:AutoGrid ChildMargin="4" Columns="Auto,*">
                            <CheckBox
                                Grid.ColumnSpan="2"
                                Content="{infrastructure:Translate 'map.inventoryFilter'}"
                                IsChecked="{Binding MapFilter.HideCompleted}" />
                            <Label Content="{infrastructure:Translate 'map.areaFilter.text'}" />
                            <ComboBox
                                DisplayMemberPath="Name"
                                ItemsSource="{Binding MapFilter.AreaFilterTypeValues, UpdateSourceTrigger=PropertyChanged}"
                                SelectedValue="{Binding MapFilter.AreaFilter}" />
                            <Label Content="{infrastructure:Translate 'map.requirementsFilter.text'}" ToolTip="{infrastructure:Translate 'map.requirementsFilter.tooltip'}" />
                            <ComboBox
                                DisplayMemberPath="Title"
                                ItemsSource="{Binding MapFilter.RequirementsFilterTypeValues, UpdateSourceTrigger=PropertyChanged}"
                                SelectedValue="{Binding MapFilter.RequirementsFilter}"
                                SelectedValuePath="Value"
                                ToolTip="{infrastructure:Translate 'map.requirementsFilter.tooltip'}" />
                            <Label Content="{infrastructure:Translate 'map.fullText.text'}" />
                            <TextBox
                                mah:TextBoxHelper.ClearTextButton="True"
                                mah:TextBoxHelper.UseFloatingWatermark="True"
                                mah:TextBoxHelper.Watermark="{infrastructure:Translate 'map.fullText.watermark'}"
                                mah:TextBoxHelper.WatermarkTrimming="CharacterEllipsis"
                                Text="{Binding MapFilter.FullText, UpdateSourceTrigger=PropertyChanged}"
                                ToolTip="{infrastructure:Translate 'map.fullText.tooltip'}" />
                            <Button
                                Grid.ColumnSpan="2"
                                Margin="0,4,0,4"
                                Padding="6"
                                Command="{Binding ResetAllDoneCommand}"
                                Content="{infrastructure:Translate 'map.buttons.resetAllDone.text'}"
                                ToolTip="{infrastructure:Translate 'map.buttons.resetAllDone.tooltip'}" />
                        </st:AutoGrid>
                    </GroupBox>
                    <GroupBox Grid.Row="1" Header="{infrastructure:Translate 'map.pois'}">
                        <st:AutoGrid Columns="*" Rows="Auto,*">
                            <Button
                                Margin="4,4,4,6"
                                Command="{Binding DeselectAllCommand}"
                                Content="{infrastructure:Translate 'map.buttons.deselectAll'}"
                                DockPanel.Dock="Right" />
                            <ScrollViewer
                                CanContentScroll="True"
                                HorizontalScrollBarVisibility="Disabled"
                                PreviewMouseWheel="PoiSelector_OnPreviewMouseWheel"
                                VerticalScrollBarVisibility="Auto">
                                <TreeView ItemsSource="{Binding PoiGroups}">
                                    <TreeView.Resources>
                                        <!--  Template for PoiGroup  -->
                                        <HierarchicalDataTemplate DataType="{x:Type models:PoiGroup}">
                                            <CheckBox IsChecked="{Binding Enabled}">
                                                <CheckBox.Content>
                                                    <StackPanel
                                                        HorizontalAlignment="Left"
                                                        VerticalAlignment="Center"
                                                        Orientation="Horizontal">
                                                        <Image
                                                            Width="24"
                                                            Height="24"
                                                            Source="{Binding Icon}" />
                                                        <Label Content="{Binding Title}" />
                                                    </StackPanel>
                                                </CheckBox.Content>
                                            </CheckBox>
                                        </HierarchicalDataTemplate>

                                        <!--  Template for PoiGroupCollection  -->
                                        <HierarchicalDataTemplate DataType="{x:Type models:PoiGroupCollection}" ItemsSource="{Binding PoiGroups}">
                                            <StackPanel Orientation="Horizontal">
                                                <CheckBox IsChecked="{Binding Enabled}" />
                                                <TextBlock Text="{Binding Title}" />
                                            </StackPanel>
                                        </HierarchicalDataTemplate>
                                    </TreeView.Resources>
                                </TreeView>
                            </ScrollViewer>
                        </st:AutoGrid>
                    </GroupBox>
                </Grid>
            </mah:Flyout>
            <mah:Flyout
                x:Name="PoiDetailsFlyout"
                Width="310"
                AreAnimationsEnabled="False"
                Header="{infrastructure:Translate 'map.details'}"
                Position="Right">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                        <ContentPresenter
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Top"
                            Content="{Binding SelectedPoi, Mode=OneWay}"
                            ContentTemplateSelector="{StaticResource PoiDetailsTemplateSelector}"
                            DockPanel.Dock="Top" />
                    </ScrollViewer>
                    <TextBlock
                        Grid.Row="1"
                        Padding="12"
                        TextAlignment="Right">
                        Static information provided by<Underline Cursor="Hand" Foreground="{DynamicResource MahApps.Brushes.Accent}">
                            <Run MouseLeftButtonDown="sotfLink_Click" Text="sotf.th.gl" />
                        </Underline>
                    </TextBlock>
                </Grid>
            </mah:Flyout>
        </mah:FlyoutsControl>
    </mah:MetroWindow.Flyouts>
    <Grid Name="MapGrid">
        <zoomControl:ZoomControl
            x:Name="MapZoomControl"
            MaxZoom="8"
            Mode="Fill"
            ModifierMode="None"
            MouseUp="ZoomControl_OnMouseUp"
            PreviewMouseDown="ZoomControl_OnPreviewMouseDown"
            Zoom="{Binding Zoom, Source={StaticResource ZoomHandler}, Mode=OneWayToSource}">
            <zoomControl:ZoomControl.Resources>
                <zoomControl:EqualityToBooleanConverter x:Key="EqualityConverter" />
            </zoomControl:ZoomControl.Resources>
            <zoomControl:ZoomControl.Template>
                <ControlTemplate TargetType="{x:Type zoomControl:ZoomControl}">
                    <Grid>
                        <Border
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            ClipToBounds="{TemplateBinding ClipToBounds}">
                            <zoomControl:ZoomContentPresenter x:Name="PART_Presenter" ClipToBounds="False" />
                        </Border>
                        <Border
                            Height="40"
                            Margin="5"
                            Padding="5"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Background="#88C0C0C0"
                            CornerRadius="5">
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    Margin="0,0,5,0"
                                    Background="{DynamicResource MahApps.Brushes.Accent}"
                                    Command="{Binding OpenCategorySelectorCommand}"
                                    Content="{infrastructure:Translate 'map.options'}" />
                                <ToggleButton
                                    Width="55"
                                    Margin="0,0,5,0"
                                    Content="{infrastructure:Translate 'map.fill'}"
                                    IsChecked="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Mode, Converter={StaticResource EqualityConverter}, ConverterParameter={x:Static zoomControl:ZoomControlModes.Fill}}" />
                                <ComboBox
                                    BorderBrush="Transparent"
                                    SelectedValue="{Binding MapSelection}"
                                    SelectedValuePath="Tag">
                                    <ComboBoxItem Content="{infrastructure:Translate 'map.mapType.dark'}" Tag="{x:Static viewModel:MapType.Dark}" />
                                    <ComboBoxItem Content="{infrastructure:Translate 'map.mapType.original'}" Tag="{x:Static viewModel:MapType.Original}" />
                                </ComboBox>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </zoomControl:ZoomControl.Template>
            <Grid>
                <Image
                    Width="4096"
                    Height="4096"
                    Source="{Binding MapImageSource}" />

                <ItemsControl ItemTemplateSelector="{StaticResource PoiTemplateSelector}" ItemsSource="{Binding Pois}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas Width="4096" Height="4096" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemContainerStyle>
                        <Style>
                            <Setter Property="Canvas.Left" Value="{Binding IconLeft}" />
                            <Setter Property="Canvas.Top" Value="{Binding IconTop}" />
                            <Setter Property="Canvas.ZIndex" Value="{Binding IconZIndex}" />
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                </ItemsControl>
            </Grid>
        </zoomControl:ZoomControl>
        <Grid
            Margin="0,0,0,10"
            HorizontalAlignment="Center"
            VerticalAlignment="Bottom">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Slider
                Width="{Binding ElementName=MapGrid, Path=ActualWidth, Converter={StaticResource HalfWidthConverter}}"
                mah:SliderHelper.TrackFillBrush="White"
                mah:SliderHelper.TrackFillHoverBrush="White"
                mah:SliderHelper.TrackFillPressedBrush="White"
                Maximum="{Binding ElementName=MapZoomControl, Path=MaxZoom}"
                Minimum="{Binding ElementName=MapZoomControl, Path=MinZoom}"
                Value="{Binding ElementName=MapZoomControl, Path=Zoom}">
                <Slider.Effect>
                    <DropShadowEffect
                        BlurRadius="10"
                        Direction="320"
                        Opacity="0.5"
                        ShadowDepth="2"
                        Color="Black" />
                </Slider.Effect>
            </Slider>
        </Grid>
    </Grid>
</mah:MetroWindow>
